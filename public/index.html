<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Eps1llon Hub Premium - Unlock unparalleled features and dedicated support with a one-time payment.">
  <meta name="robots" content="index, follow">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com https://challenges.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' https://i.imgur.com data:; connect-src 'self' https://eps1llon.win https://challenges.cloudflare.com; frame-src 'self' https://challenges.cloudflare.com;">
  <title>Eps1llon Hub Premium - The Ultimate Advantage</title>
  <!--
    For production, generate tailwind.css using Tailwind CLI:
    1. Install Tailwind: `npm install -D tailwindcss`
    2. Create input.css with: @tailwind base; @tailwind components; @tailwind utilities;
    3. Run: `npx tailwindcss -i input.css -o tailwind.css --minify`
    4. Host tailwind.css on your server at /tailwind.css or adjust the path below.
  -->
  <link rel="stylesheet" href="/tailwind.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad" async defer></script>
  <style>:root{--bg-dark:#0a0c10;--bg-light:#1a1d25;--primary:#00a8ff;--secondary:#ffc107;--tertiary:#1f2a40;--glow-primary:0 0 35px rgba(0,168,255,.7);--text-light:#e0e6f0;--text-muted:#9ba4b5;--border-color:rgba(255,255,255,.08);--success:#28a745}html{scroll-behavior:smooth}body{font-family:Poppins,sans-serif;background-color:var(--bg-dark);color:var(--text-muted);min-height:100vh;overflow-x:hidden;position:relative}.text-primary{color:var(--primary)!important}.text-text-light{color:var(--text-light)!important}.text-text-muted{color:var(--text-muted)!important}.bg-tertiary{background-color:var(--tertiary)!important}.bg-bg-dark{background-color:var(--bg-dark)!important}.bg-bg-light{background-color:var(--bg-light)!important}.border-border-color{border-color:var(--border-color)!important}.bg-primary\/20{background-color:rgba(0,168,255,.2)!important}.bg-primary\/30{background-color:rgba(0,168,255,.3)!important}.text-green-400{color:#34d399!important}@keyframes move-stars{from{transform:translateY(0)}to{transform:translateY(-1000px)}}.stars{position:fixed;top:0;left:0;right:0;width:100%;height:200%;display:block;z-index:-2;background-repeat:repeat;animation:move-stars linear infinite}#stars1{background-image:radial-gradient(1px 1px at 20px 30px,#eee,transparent),radial-gradient(1px 1px at 90px 60px,#fff,transparent),radial-gradient(1px 1px at 150px 180px,#ddd,transparent);background-size:200px 200px;animation-duration:120s}#stars2{background-image:radial-gradient(1.5px 1.5px at 50px 100px,#fff,transparent),radial-gradient(1.5px 1.5px at 120px 40px,#ddd,transparent),radial-gradient(2px 2px at 180px 150px,#fff,transparent);background-size:300px 300px;animation-duration:90s}#stars3{background-image:radial-gradient(2px 2px at 10px 160px,#ddd,transparent),radial-gradient(2.5px 2.5px at 100px 80px,#fff,transparent);background-size:400px 400px;animation-duration:60s}.ripple{position:absolute;border-radius:50%;background-color:rgba(255,255,255,.3);transform:scale(0);animation:ripple-effect .6s linear;pointer-events:none}@keyframes ripple-effect{to{transform:scale(4);opacity:0}}.has-ripple{position:relative;overflow:hidden}.logo-glow{filter:drop-shadow(0 0 20px rgba(255,255,255,.8)) drop-shadow(0 0 40px rgba(255,255,255,.5))}.text-gradient-primary{background:linear-gradient(45deg,var(--primary),#00c6ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}body.chat-active #main-website,body.chat-active #main-footer{display:none}#ticket-system{display:none}body.chat-active #ticket-system{display:block}[data-animate]{opacity:0;transform:translateY(30px);transition:opacity .6s ease-out,transform .6s ease-out}[data-animate].is-visible{opacity:1;transform:translateY(0)}.btn-primary{background-color:var(--primary);box-shadow:var(--glow-primary);transition:all .3s ease;border:1px solid rgba(0,168,255,.3)}.btn-primary:hover:not(:disabled){background-color:#0095e0;box-shadow:0 0 45px rgba(0,168,255,.8);transform:translateY(-3px)}.btn-primary:active:not(:disabled){transform:translateY(1px)}#payment-methods{position:relative}.card{background:linear-gradient(145deg,rgba(26,29,37,.8),rgba(31,42,64,.8));border:1px solid var(--border-color);box-shadow:0 5px 20px rgba(0,0,0,.2);transition:all .3s ease-in-out;transform:translateZ(0);backdrop-filter:blur(5px);position:relative}.card::before{content:'';position:absolute;left:var(--mouse-x,-100%);top:var(--mouse-y,-100%);width:250px;height:250px;background:radial-gradient(circle at center,rgba(0,168,255,.1),transparent 70%);transform:translate(-50%,-50%);opacity:0;transition:opacity .3s ease,left .1s linear,top .1s linear;pointer-events:none;z-index:1}.card:hover{transform:translateY(-5px) scale(1.02) translateZ(0);border-color:var(--primary);background:linear-gradient(145deg,hsl(222 22% 18%),hsl(220 37% 15%));box-shadow:0 8px 30px rgba(0,0,0,.4)}.card:hover::before{opacity:1}.card-special::before{background:radial-gradient(circle at center,rgba(255,193,7,.1),transparent 70%)}.card-special:hover{border-color:var(--secondary)}.modal-backdrop{background-color:rgba(0,0,0,.8);backdrop-filter:blur(12px);opacity:0;transition:opacity .3s ease-in-out}.modal-backdrop.visible{opacity:1}.modal-content{background-color:var(--bg-light);border:1px solid var(--border-color);box-shadow:0 10px 40px rgba(0,0,0,.4);transform:translateY(20px) scale(.98);opacity:0;transition:transform .3s cubic-bezier(.175,.885,.32,1.275),opacity .3s ease-in-out;position:relative}.modal-backdrop.visible .modal-content{transform:translateY(0) scale(1);opacity:1}.form-input{background-color:var(--bg-dark);border:1px solid var(--border-color);color:var(--text-light);transition:all .3s ease}.form-input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,168,255,.3);outline:none}.floating{animation:floating 3s ease-in-out infinite}@keyframes floating{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}#toast-notification{position:fixed;top:20px;right:20px;background-color:var(--tertiary);color:#fff;padding:12px 20px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.3);opacity:0;transform:translateY(-20px);transition:opacity .3s,transform .3s;z-index:9999}#toast-notification.show{opacity:1;transform:translateY(0)}#ticket-system{position:fixed;inset:0;z-index:100;background-color:var(--bg-dark)}.ticket-app-container{display:flex;height:100vh}.ticket-sidebar{width:320px;background:var(--bg-dark);border-right:1px solid var(--border-color);display:flex;flex-direction:column;flex-shrink:0}.sidebar-header{padding:1.25rem;border-bottom:1px solid var(--border-color);flex-shrink:0}.sidebar-content{overflow-y:auto;padding:.75rem;flex:1}.ticket-main{flex:1;display:flex;flex-direction:column;height:100%}.chat-header{display:flex;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid var(--border-color);background-color:rgba(26,29,37,.7);flex-shrink:0}.chat-container{flex:1;display:flex;flex-direction:column;overflow:hidden}.chat-messages{flex:1;padding:1.5rem;overflow-y:auto;display:flex;flex-direction:column;gap:1.5rem}.chat-input-area{padding:1rem 1.5rem;border-top:1px solid var(--border-color);background:rgba(26,29,37,.8)}#new-ticket-btn:disabled{cursor:not-allowed;opacity:1}#new-ticket-btn[data-status=in-progress]{background-color:var(--tertiary);color:var(--primary);border:1px solid var(--primary);box-shadow:0 0 20px rgba(0,168,255,.4);animation:pulse-glow 2s ease-in-out infinite}@keyframes pulse-glow{0%{box-shadow:0 0 20px rgba(0,168,255,.4)}50%{box-shadow:0 0 30px rgba(0,168,255,.7)}100%{box-shadow:0 0 20px rgba(0,168,255,.4)}}.ticket-item{padding:1rem;border-radius:10px;margin-bottom:.5rem;cursor:pointer;transition:all .2s ease;border:1px solid transparent}.ticket-item:hover{background:var(--bg-light);transform:translateX(4px)}.ticket-item.active{background:var(--tertiary);border-color:var(--primary);box-shadow:inset 0 0 15px rgba(0,168,255,.2),0 0 15px rgba(0,168,255,.1)}.ticket-item-preview{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.875rem;color:var(--text-muted)}.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.empty-state i{font-size:3rem;color:var(--tertiary);margin-bottom:1rem}.online-indicator{width:10px;height:10px;background-color:var(--success);border-radius:50%;box-shadow:0 0 8px var(--success)}.chat-bubble{padding:.75rem 1.25rem;border-radius:1.25rem;max-width:80%;animation:bubbleAppear .3s ease-out;word-wrap:break-word;line-height:1.5}.chat-bubble-user{background-color:var(--primary);color:#fff;border-bottom-right-radius:.25rem}.chat-bubble-seller{background-color:var(--tertiary);color:var(--text-light);border-bottom-left-radius:.25rem}@keyframes bubbleAppear{from{opacity:0;transform:translateY(10px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}.payment-method-option{display:flex;align-items:center;padding:1rem;border-radius:.5rem;border:1px solid var(--border-color);margin-bottom:.75rem;cursor:pointer;transition:all .2s ease}.payment-method-option:hover{background-color:var(--bg-light);border-color:var(--primary)}.payment-method-option.selected{background-color:var(--tertiary);border-color:var(--primary);box-shadow:0 0 15px rgba(0,168,255,.3)}.payment-method-option i{font-size:1.75rem;margin-right:1.25rem;width:35px;text-align:center}.payment-method-option .method-name{font-weight:600;font-size:1.1rem;color:var(--text-light)}.ticket-payment-badge{display:inline-flex;align-items:center;gap:.5rem;background-color:var(--bg-dark);padding:.25rem .75rem;border-radius:1rem;font-size:.75rem;color:var(--text-light);border:1px solid var(--border-color)}.ticket-payment-badge i{font-size:.875rem}#completed-view{text-align:center}.license-key-wrapper{background:var(--bg-dark);border:1px solid var(--border-color);padding:1rem;border-radius:.5rem;margin-top:2rem}#license-key{font-family:monospace;font-size:1.25rem;color:var(--primary);word-break:break-all}.turnstile-error{color:#ff4d4f;font-size:.875rem;margin-top:.5rem;text-align:center}@media (max-width:768px){.ticket-app-container.mobile-chat-view .ticket-sidebar{display:none}.ticket-app-container:not(.mobile-chat-view) .ticket-main{display:none}.ticket-sidebar{width:100%;border-right:none}}</style>
</head>
<body class="antialiased">
  <div id="stars1" class="stars"></div>
  <div id="stars2" class="stars"></div>
  <div id="stars3" class="stars"></div>
  <div id="main-website">
    <header class="py-4 px-8 flex justify-between items-center bg-black/30 backdrop-blur-md sticky top-0 z-40 border-b border-gray-800">
      <h1 class="text-3xl font-extrabold text-white flex items-center">
        <img src="https://i.imgur.com/4LQlJ9V.png" alt="Script Logo" class="h-10 w-10 mr-3 object-contain rounded-full shadow-lg logo-glow" loading="lazy">
        Eps<span class="text-primary">1</span>llon Hub
      </h1>
      <nav id="nav-menu" class="hidden md:flex items-center space-x-8">
        <a href="#features" class="text-text-light hover:text-primary transition-colors text-lg font-medium relative group has-ripple">Features<span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300"></span></a>
        <a href="#payment-methods" class="text-text-light hover:text-primary transition-colors text-lg font-medium relative group has-ripple">Payments<span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300"></span></a>
      </nav>
      <div class="hidden md:flex items-center space-x-4">
        <div id="auth-links">
          <button id="login-nav-btn" class="bg-primary/20 text-primary py-2 px-5 rounded-full hover:bg-primary/30 transition duration-300 font-semibold has-ripple">Login / Sign Up</button>
        </div>
        <div id="user-info" class="hidden items-center space-x-4">
          <span id="username-display" class="text-text-light font-medium"></span>
          <button id="logout-button" class="bg-red-500/20 text-red-400 py-2 px-4 rounded-full hover:bg-red-500/30 transition duration-300 text-sm font-semibold has-ripple">Logout</button>
        </div>
      </div>
      <button id="mobile-menu-btn" class="md:hidden text-text-light text-2xl has-ripple"><i class="fas fa-bars"></i></button>
    </header>
    <main class="relative z-10">
      <section id="hero-section" class="text-center py-28 md:py-40 px-4 relative overflow-hidden">
        <div class="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none">
          <img src="https://i.imgur.com/4LQlJ9V.png" alt="Script Logo Background" class="h-64 w-64 md:h-96 md:w-96 object-contain animate-pulse" loading="lazy">
        </div>
        <div class="relative z-10">
          <h2 class="text-6xl md:text-8xl font-black text-white leading-tight mb-4 tracking-tighter" data-animate>Eps<span class="text-gradient-primary drop-shadow-lg" style="--tw-drop-shadow:var(--glow-primary)">1</span>llon Hub Premium</h2>
          <p class="text-xl md:text-2xl max-w-4xl mx-auto mb-6 text-text-light opacity-90" data-animate style="transition-delay:100ms">Unlock the ultimate advantage with unparalleled features and dedicated support.</p>
          <div data-animate style="transition-delay:200ms">
            <div class="text-4xl font-extrabold text-primary mb-2"><span class="text-text-light">$10</span> Lifetime</div>
            <p class="text-text-muted mb-10">One-time payment for full, permanent access.</p>
            <button id="purchase-btn" class="relative text-white font-bold py-4 px-12 rounded-full text-xl btn-primary transition-all hover:scale-105 active:scale-95 floating has-ripple"><span id="purchase-btn-content"><i class="fas fa-shopping-cart mr-3"></i> Purchase Now</span></button>
          </div>
        </div>
      </section>
      <section id="payment-methods" class="py-20 md:py-28 px-4">
        <div class="container mx-auto max-w-7xl text-center">
          <h2 class="text-4xl md:text-5xl font-black text-white mb-4 tracking-tighter" data-animate>Seamless Transactions, <span class="text-gradient-primary">Universal Acceptance</span></h2>
          <p class="text-lg md:text-xl max-w-3xl mx-auto mb-16 text-text-muted" data-animate style="transition-delay:100ms">We support a vast array of secure payment options. Your premium access is just a click away.</p>
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6" data-animate style="transition-delay:200ms">
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fab fa-paypal text-5xl mb-4 text-blue-600"></i><h3 class="text-lg font-bold text-text-light z-10">PayPal</h3></div>
            <div class="card card-special has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fab fa-bitcoin text-5xl mb-4 text-yellow-500"></i><h3 class="text-lg font-bold text-text-light z-10">Crypto</h3></div>
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fas fa-credit-card text-5xl mb-4 text-indigo-400"></i><h3 class="text-lg font-bold text-text-light z-10">Credit Card</h3></div>
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fas fa-university text-5xl mb-4 text-gray-400"></i><h3 class="text-lg font-bold text-text-light z-10">Bank Transfer</h3></div>
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fab fa-google-pay text-5xl mb-4 text-blue-500"></i><h3 class="text-lg font-bold text-text-light z-10">Google Pay</h3></div>
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fab fa-apple-pay text-5xl mb-4 text-gray-300"></i><h3 class="text-lg font-bold text-text-light z-10">Apple Pay</h3></div>
            <div class="card has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fas fa-dollar-sign text-5xl mb-4 text-green-500"></i><h3 class="text-lg font-bold text-text-light z-10">CashApp</h3></div>
            <div class="card card-special has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fas fa-paw text-5xl mb-4 text-orange-400"></i><h3 class="text-lg font-bold text-text-light z-10">Gag Pets</h3></div>
            <div class="card card-special has-ripple flex flex-col items-center justify-center p-6 text-center aspect-square rounded-2xl"><i class="fas fa-brain text-5xl mb-4 text-pink-500"></i><h3 class="text-lg font-bold text-text-light z-10">Secret Brainrots</h3></div>
          </div>
        </div>
      </section>
      <section id="features" class="py-20 md:py-28 px-4">
        <div class="container mx-auto max-w-6xl text-center">
          <h2 class="text-4xl md:text-5xl font-black text-white mb-4 tracking-tighter" data-animate>Engineered for <span class="text-gradient-primary">Dominance</span></h2>
          <p class="text-lg md:text-xl max-w-3xl mx-auto mb-16 text-text-muted" data-animate style="transition-delay:100ms">Eps1llon Hub isn't just a tool; it's a complete competitive advantage, built on a foundation of power, stability, and continuous innovation.</p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8" data-animate style="transition-delay:200ms">
            <div class="card has-ripple p-8 text-left rounded-2xl"><i class="fas fa-bolt text-3xl mb-4 text-primary"></i><h3 class="text-2xl font-bold text-white mb-2 z-10">Unmatched Performance</h3><p class="text-text-muted z-10">Experience zero-lag execution and flawless stability, giving you the edge when it matters most.</p></div>
            <div class="card has-ripple p-8 text-left rounded-2xl"><i class="fas fa-shield-halved text-3xl mb-4 text-primary"></i><h3 class="text-2xl font-bold text-white mb-2 z-10">Constant Innovation</h3><p class="text-text-muted z-10">Receive frequent, seamless updates with new features that keep you ahead of the curve.</p></div>
            <div class="card has-ripple p-8 text-left rounded-2xl"><i class="fas fa-headset text-3xl mb-4 text-primary"></i><h3 class="text-2xl font-bold text-white mb-2 z-10">Dedicated Support</h3><p class="text-text-muted z-10">Our expert team is available around the clock to assist you with any questions or needs.</p></div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <footer id="main-footer" class="text-center py-10 border-t border-gray-800 bg-black/30 backdrop-blur-md">
    <p class="text-text-muted text-lg">&copy; 2025 Eps1llon Hub. All rights reserved.</p>
  </footer>
  <div id="auth-modal" class="fixed inset-0 z-[200] modal-backdrop items-center justify-center hidden">
    <div class="modal-content w-full max-w-md p-8 rounded-2xl">
      <button id="close-auth-modal-btn" class="absolute top-4 right-4 text-text-muted hover:text-white text-2xl has-ripple">&times;</button>
      <div id="signup-view">
        <h3 class="text-3xl font-bold text-white mb-3 text-center">Create Account</h3>
        <p class="text-center mb-8 text-text-muted">Join to begin your secure purchase.</p>
        <form id="signup-form">
          <div class="mb-5">
            <label for="signup-username" class="block mb-2 text-sm font-medium text-text-light">Username</label>
            <input type="text" id="signup-username" class="form-input w-full p-3 rounded-lg" placeholder="Choose a unique username" required>
          </div>
          <div class="mb-4">
            <label for="signup-password" class="block mb-2 text-sm font-medium text-text-light">Password</label>
            <input type="password" id="signup-password" class="form-input w-full p-3 rounded-lg" placeholder="Secure password" required>
          </div>
          <div class="mt-4 mb-6">
            <div id="turnstile-signup" class="cf-turnstile" data-sitekey="" data-theme="dark"></div>
            <p id="turnstile-error" class="turnstile-error hidden">Please complete the verification challenge.</p>
          </div>
          <button type="submit" class="w-full text-white font-bold py-3 px-6 rounded-lg btn-primary text-lg has-ripple">Sign Up</button>
        </form>
        <p class="text-center mt-6 text-text-muted">Already have an account? <a href="#" id="show-login" class="text-primary hover:underline font-medium">Log In</a></p>
      </div>
      <div id="login-view" class="hidden">
        <h3 class="text-3xl font-bold text-white mb-3 text-center">Welcome Back</h3>
        <p class="text-center mb-8 text-text-muted">Log in to continue your purchase.</p>
        <form id="login-form">
          <div class="mb-5">
            <label for="login-username" class="block mb-2 text-sm font-medium text-text-light">Username</label>
            <input type="text" id="login-username" class="form-input w-full p-3 rounded-lg" placeholder="Your username" required>
          </div>
          <div class="mb-7">
            <label for="login-password" class="block mb-2 text-sm font-medium text-text-light">Password</label>
            <input type="password" id="login-password" class="form-input w-full p-3 rounded-lg" placeholder="Your password" required>
          </div>
          <button type="submit" class="w-full text-white font-bold py-3 px-6 rounded-lg btn-primary text-lg has-ripple">Log In</button>
        </form>
        <p class="text-center mt-6 text-text-muted">Don't have an account? <a href="#" id="show-signup" class="text-primary hover:underline font-medium">Sign Up</a></p>
      </div>
    </div>
  </div>
  <div id="payment-method-modal" class="fixed inset-0 z-[200] modal-backdrop items-center justify-center hidden">
    <div class="modal-content w-full max-w-md p-8 rounded-2xl">
      <button id="close-payment-modal-btn" class="absolute top-4 right-4 text-text-muted hover:text-white text-2xl has-ripple">&times;</button>
      <h3 class="text-3xl font-bold text-white mb-3 text-center">Payment Method</h3>
      <p class="text-center mb-8 text-text-muted">How would you like to pay?</p>
      <div class="payment-method-option has-ripple" data-method="PayPal"><i class="fab fa-paypal text-blue-600"></i><div class="method-name">PayPal</div></div>
      <div class="payment-method-option has-ripple" data-method="Crypto"><i class="fab fa-bitcoin text-yellow-500"></i><div class="method-name">Crypto</div></div>
      <div class="payment-method-option has-ripple" data-method="Credit Card"><i class="fas fa-credit-card text-indigo-400"></i><div class="method-name">Credit Card</div></div>
      <div class="payment-method-option has-ripple" data-method="Bank Transfer"><i class="fas fa-university text-gray-400"></i><div class="method-name">Bank Transfer</div></div>
      <div class="payment-method-option has-ripple" data-method="Google Pay"><i class="fab fa-google-pay text-blue-500"></i><div class="method-name">Google Pay</div></div>
      <div class="payment-method-option has-ripple" data-method="Apple Pay"><i class="fab fa-apple-pay text-gray-300"></i><div class="method-name">Apple Pay</div></div>
      <div class="payment-method-option has-ripple" data-method="CashApp"><i class="fas fa-dollar-sign text-green-500"></i><div class="method-name">CashApp</div></div>
      <div class="payment-method-option has-ripple" data-method="Gag Pets"><i class="fas fa-paw text-orange-400"></i><div class="method-name">Gag Pets</div></div>
      <div class="payment-method-option has-ripple" data-method="Secret Brainrots"><i class="fas fa-brain text-pink-500"></i><div class="method-name">Secret Brainrots</div></div>
      <button id="confirm-payment-btn" class="w-full mt-6 text-white font-bold py-3 px-6 rounded-lg btn-primary text-lg opacity-50 cursor-not-allowed has-ripple" disabled>Create Purchase Ticket</button>
    </div>
  </div>
  <div id="ticket-system">
    <div id="ticket-app-container" class="ticket-app-container">
      <aside class="ticket-sidebar">
        <div class="sidebar-header flex justify-between items-center">
          <div>
            <h2 class="text-2xl font-bold text-white">Purchase Portal</h2>
            <p class="text-sm text-text-muted">Your active & past orders.</p>
          </div>
          <button id="close-ticket-system-btn" title="Back to Main Page" class="text-text-muted hover:text-white transition-colors text-2xl has-ripple"><i class="fas fa-times"></i></button>
        </div>
        <div id="ticket-list" class="sidebar-content"></div>
        <div class="sidebar-footer p-4 border-t border-border-color mt-auto">
          <button id="new-ticket-btn" class="w-full font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center has-ripple"><i class="fas fa-plus mr-2"></i> New Purchase</button>
        </div>
      </aside>
      <main class="ticket-main">
        <div id="ticket-view-content" class="h-full flex-col hidden">
          <header class="chat-header">
            <button id="back-to-list-btn" class="md:hidden text-text-light text-xl mr-4 has-ripple"><i class="fas fa-arrow-left"></i></button>
            <div class="relative mr-4">
              <div class="w-12 h-12 rounded-full bg-tertiary flex items-center justify-center text-primary text-xl"><i class="fas fa-headset"></i></div>
              <div class="online-indicator absolute bottom-0 right-0 border-2 border-bg-light"></div>
            </div>
            <div>
              <h3 id="ticket-title" class="text-lg font-bold text-white"></h3>
              <p id="ticket-status-text" class="text-sm"></p>
            </div>
          </header>
          <div id="chat-container" class="chat-container">
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-area">
              <form id="chat-form" class="flex items-center gap-4">
                <input type="text" id="chat-input" class="form-input flex-1 p-3 rounded-full bg-tertiary" placeholder="Type your message..." autocomplete="off" required>
                <button type="submit" class="w-12 h-12 text-white font-bold rounded-full btn-primary text-lg flex items-center justify-center flex-shrink-0 has-ripple"><i class="fas fa-paper-plane"></i></button>
              </form>
            </div>
          </div>
          <div id="completed-view" class="p-8 flex-1 flex flex-col items-center justify-center hidden">
            <div class="text-green-400 mb-4"><i class="fas fa-check-circle fa-5x"></i></div>
            <h2 class="text-3xl font-bold text-white mb-2">Purchase Complete!</h2>
            <p class="text-text-muted mb-6">Thank you! Your lifetime license for Eps1llon Hub Premium is now active.</p>
            <div class="w-full max-w-md">
              <label class="block text-sm font-medium text-text-light text-left mb-2">Your License Key:</label>
              <div class="license-key-wrapper"><p id="license-key"></p></div>
              <button id="copy-key-btn" class="w-full mt-4 bg-green-500/20 text-green-400 font-semibold py-3 px-4 rounded-lg hover:bg-green-500/30 transition-colors flex items-center justify-center has-ripple"><i class="fas fa-copy mr-2"></i> Copy to Clipboard</button>
            </div>
          </div>
        </div>
        <div id="ticket-placeholder" class="empty-state">
          <i class="fas fa-ticket-alt text-7xl text-tertiary mb-6"></i>
          <h3 class="text-2xl font-bold text-white mb-2">Welcome to the Purchase Portal</h3>
          <p class="text-text-muted max-w-sm">Select a ticket from the left or create a new one to begin.</p>
        </div>
      </main>
    </div>
  </div>
  <div id="toast-notification" class="fixed top-5 right-5 bg-tertiary text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transform -translate-y-5 transition-all duration-300 z-[9999]">
    <p id="toast-message"></p>
  </div>
  <audio id="notification-sound" src="data:audio/mpeg;base64,//uQZAAAAAAAAAAAAAAAAAAAA"></audio>
  <script>
    window.onTurnstileLoad=function(){console.log("Cloudflare Turnstile loaded")};let turnstileWidgetId=null,turnstileToken=null;const App={config:{turnstileSiteKey:""},state:{isLoggedIn:!1,user:null,tickets:[],currentTicketId:null,selectedPaymentMethod:null},elements:{},async loadConfig(){try{const e=await fetch(this.API_BASE_URL+"/api/config");if(!e.ok)throw new Error("Config fetch failed: "+e.status);const t=await e.json();this.config={...this.config,...t},console.log("Config loaded:",this.config),this.elements.turnstileSignup&&this.elements.turnstileSignup.setAttribute("data-sitekey",this.config.turnstileSiteKey)}catch(e){console.error("Failed to load config:",e),this.showToast("Unable to load configuration. Please try again.")}},async init(){try{this.API_BASE_URL="https://eps1llon.win",this.cacheElements(),await this.loadConfig(),this.loadState(),this.registerEventListeners(),this.updateUI(),this.initScrollAnimations(),setInterval(()=>{this.elements.body.classList.contains("chat-active")&&this.state.isLoggedIn&&this.loadTickets()},15e3)}catch(e){console.error("App initialization failed:",e),this.showToast("Application failed to start. Please refresh.")}},cacheElements(){try{this.elements={body:document.body,purchaseBtn:document.getElementById("purchase-btn"),purchaseBtnContent:document.getElementById("purchase-btn-content"),authModal:document.getElementById("auth-modal"),closeAuthModalBtn:document.getElementById("close-auth-modal-btn"),ticketSystem:document.getElementById("ticket-system"),showLoginBtn:document.getElementById("show-login"),showSignupBtn:document.getElementById("show-signup"),signupView:document.getElementById("signup-view"),loginView:document.getElementById("login-view"),signupForm:document.getElementById("signup-form"),loginForm:document.getElementById("login-form"),chatMessages:document.querySelector(".chat-messages"),chatForm:document.querySelector("#chat-form"),chatInput:document.querySelector("#chat-input"),chatContainer:document.getElementById("chat-container"),ticketList:document.getElementById("ticket-list"),ticketViewContent:document.getElementById("ticket-view-content"),ticketPlaceholder:document.getElementById("ticket-placeholder"),ticketTitle:document.getElementById("ticket-title"),ticketStatusText:document.getElementById("ticket-status-text"),newTicketBtn:document.getElementById("new-ticket-btn"),backToListBtn:document.getElementById("back-to-list-btn"),notificationSound:document.getElementById("notification-sound"),completedView:document.getElementById("completed-view"),licenseKey:document.getElementById("license-key"),copyKeyBtn:document.getElementById("copy-key-btn"),closeTicketSystemBtn:document.getElementById("close-ticket-system-btn"),toastNotification:document.getElementById("toast-notification"),toastMessage:document.getElementById("toast-message"),paymentMethodModal:document.getElementById("payment-method-modal"),closePaymentModalBtn:document.getElementById("close-payment-modal-btn"),paymentMethodOptions:document.querySelectorAll(".payment-method-option"),confirmPaymentBtn:document.getElementById("confirm-payment-btn"),ticketAppContainer:document.querySelector(".ticket-app-container"),paymentCards:document.querySelectorAll("#payment-methods .card"),rippleElements:document.querySelectorAll(".has-ripple"),authLinks:document.getElementById("auth-links"),userInfo:document.getElementById("user-info"),usernameDisplay:document.getElementById("username-display"),logoutButton:document.getElementById("logout-button"),loginNavBtn:document.getElementById("login-nav-btn"),turnstileSignup:document.getElementById("turnstile-signup"),turnstileError:document.getElementById("turnstile-error")};for(const e in this.elements)if(!this.elements[e]&&e!=="chatMessages"&&e!=="chatForm"&&e!=="chatInput"&&e!=="paymentCards"&&e!=="rippleElements"&&e!=="paymentMethodOptions")console.warn(`Element ${e} not found in DOM`)}catch(e){console.error("Error caching elements:",e),this.showToast("Application error. Please refresh.")}},loadState(){try{const e=localStorage.getItem("token");if(e){const t=JSON.parse(atob(e.split(".")[1]));t.exp*1e3>Date.now()?(this.state.isLoggedIn=!0,this.state.user={id:t.id,username:t.username},this.loadTickets()):this.logout()}this.updateUI()}catch(e){console.error("Error loading state:",e),this.logout(),this.showToast("Session error. Please log in again.")}},async apiCall(e,t={}){try{const a=localStorage.getItem("token"),s={...t,headers:{"Content-Type":"application/json",...t.headers}};a&&(s.headers.Authorization=`Bearer ${a}`);const n=await fetch(this.API_BASE_URL+e,s);if(n.status===401||n.status===403)return e==="/register"?this.showToast("Verification failed. Please try again."):this.state.isLoggedIn&&(this.logout(),this.showToast("Session expired. Please log in again.")),null;if(!n.ok)throw new Error(`API call failed: ${n.status}`);return n}catch(a){return console.error(`API call to ${e} failed:`,a),this.showToast("Network error. Please check your connection."),null}},async loadTickets(){if(!this.state.isLoggedIn)return;try{const e=await this.apiCall("/tickets/my");if(e&&e.ok){const t=await e.json();if(this.state.currentTicketId&&this.state.tickets.length>0){const e=this.state.tickets.find(e=>e.id===this.state.currentTicketId),a=t.find(e=>e.id===this.state.currentTicketId);e&&a&&e.messages.length<a.messages.length&&a.messages[a.messages.length-1].sender==="seller"&&this.elements.notificationSound.play().catch(e=>console.error("Notification sound error:",e))}this.state.tickets=t,this.renderSidebar(),this.state.currentTicketId&&(this.state.tickets.find(e=>e.id===this.state.currentTicketId)?(this.renderTicketView(this.state.tickets.find(e=>e.id===this.state.currentTicketId))):(this.state.currentTicketId=null,this.elements.ticketViewContent.classList.add("hidden"),this.elements.ticketPlaceholder.classList.remove("hidden")))}}catch(e){console.error("Error loading tickets:",e),this.showToast("Failed to load tickets.")}},registerEventListeners(){try{this.elements.purchaseBtn&&this.elements.purchaseBtn.addEventListener("click",this.handlePurchaseClick.bind(this)),this.elements.authModal&&this.elements.authModal.addEventListener("click",e=>e.target===this.elements.authModal&&this.closeAuthModal()),this.elements.closeAuthModalBtn&&this.elements.closeAuthModalBtn.addEventListener("click",this.closeAuthModal.bind(this)),this.elements.showLoginBtn&&this.elements.showLoginBtn.addEventListener("click",e=>{e.preventDefault(),this.toggleAuthView(!0)}),this.elements.showSignupBtn&&this.elements.showSignupBtn.addEventListener("click",e=>{e.preventDefault(),this.toggleAuthView(!1)}),this.elements.signupForm&&this.elements.signupForm.addEventListener("submit",this.handleSignup.bind(this)),this.elements.loginForm&&this.elements.loginForm.addEventListener("submit",this.handleLogin.bind(this)),this.elements.newTicketBtn&&this.elements.newTicketBtn.addEventListener("click",this.showPaymentMethodModal.bind(this)),this.elements.backToListBtn&&this.elements.backToListBtn.addEventListener("click",()=>this.elements.ticketAppContainer.classList.remove("mobile-chat-view")),this.elements.chatForm&&this.elements.chatForm.addEventListener("submit",this.handleChatMessage.bind(this)),this.elements.copyKeyBtn&&this.elements.copyKeyBtn.addEventListener("click",this.copyLicenseKey.bind(this)),this.elements.closeTicketSystemBtn&&this.elements.closeTicketSystemBtn.addEventListener("click",this.closeTicketSystem.bind(this)),this.elements.paymentMethodModal&&this.elements.paymentMethodModal.addEventListener("click",e=>e.target===this.elements.paymentMethodModal&&this.closePaymentMethodModal()),this.elements.closePaymentModalBtn&&this.elements.closePaymentModalBtn.addEventListener("click",this.closePaymentMethodModal.bind(this)),this.elements.confirmPaymentBtn&&this.elements.confirmPaymentBtn.addEventListener("click",this.handlePaymentMethodConfirm.bind(this)),this.elements.logoutButton&&this.elements.logoutButton.addEventListener("click",this.logout.bind(this)),this.elements.loginNavBtn&&this.elements.loginNavBtn.addEventListener("click",this.openAuthModal.bind(this)),this.elements.paymentMethodOptions&&this.elements.paymentMethodOptions.forEach(e=>e.addEventListener("click",()=>{this.elements.paymentMethodOptions.forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),this.state.selectedPaymentMethod=e.dataset.method,this.elements.confirmPaymentBtn.disabled=!1,this.elements.confirmPaymentBtn.classList.remove("opacity-50","cursor-not-allowed")})),this.elements.paymentCards&&this.elements.paymentCards.forEach(e=>e.addEventListener("mousemove",t=>{const a=e.getBoundingClientRect(),s=t.clientX-a.left,n=t.clientY-a.top;e.style.setProperty("--mouse-x",s+"px"),e.style.setProperty("--mouse-y",n+"px")})),this.elements.rippleElements&&this.elements.rippleElements.forEach(e=>e.addEventListener("click",this.createRipple))}catch(e){console.error("Error registering event listeners:",e),this.showToast("Application error. Please refresh.")}},createRipple(e){try{const t=e.currentTarget,a=document.createElement("span"),s=t.getBoundingClientRect(),n=Math.max(s.width,s.height);a.style.width=a.style.height=n+"px",a.style.left=e.clientX-s.left-n/2+"px",a.style.top=e.clientY-s.top-n/2+"px",a.classList.add("ripple"),t.appendChild(a),setTimeout(()=>a.remove(),600)}catch(e){console.error("Error creating ripple effect:",e)}},updateUI(){try{const e=this.getActiveTicket();let t="";this.state.isLoggedIn?(this.elements.authLinks&&this.elements.authLinks.classList.add("hidden"),this.elements.userInfo&&this.elements.userInfo.classList.remove("hidden"),this.elements.usernameDisplay&&(this.elements.usernameDisplay.textContent=this.state.user.username),t=e||this.state.tickets.length>0?'<i class="fas fa-arrow-right mr-3"></i> My Purchases':'<i class="fas fa-shopping-cart mr-3"></i> Purchase Now'):(this.elements.authLinks&&this.elements.authLinks.classList.remove("hidden"),this.elements.userInfo&&this.elements.userInfo.classList.add("hidden"),t='<i class="fas fa-shopping-cart mr-3"></i> Purchase Now'),this.elements.purchaseBtnContent&&(this.elements.purchaseBtnContent.innerHTML=t)}catch(e){console.error("Error updating UI:",e),this.showToast("UI update failed.")}},showToast(e){try{this.elements.toastMessage&&(this.elements.toastMessage.textContent=e),this.elements.toastNotification&&this.elements.toastNotification.classList.add("show"),setTimeout(()=>{this.elements.toastNotification&&this.elements.toastNotification.classList.remove("show")},3e3)}catch(e){console.error("Error showing toast:",e)}},initScrollAnimations(){try{const e=document.querySelectorAll("[data-animate]"),t=new IntersectionObserver((e,a)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),a.unobserve(e.target))})},{threshold:.1});e.forEach(e=>t.observe(e))}catch(e){console.error("Error initializing scroll animations:",e)}},handlePurchaseClick(){try{this.state.isLoggedIn?this.openTicketSystem():this.openAuthModal()}catch(e){console.error("Error handling purchase click:",e),this.showToast("Error starting purchase.")}},openAuthModal(){try{this.elements.authModal&&(this.elements.authModal.classList.remove("hidden"),this.elements.authModal.classList.add("flex"),setTimeout(()=>{this.elements.authModal.classList.add("visible")},10),this.renderTurnstile())}catch(e){console.error("Error opening auth modal:",e),this.showToast("Error opening login modal.")}},closeAuthModal(){try{this.elements.authModal&&(this.elements.authModal.classList.remove("visible"),setTimeout(()=>{this.elements.authModal.classList.add("hidden"),this.elements.authModal.classList.remove("flex"),this.resetTurnstile()},300))}catch(e){console.error("Error closing auth modal:",e)}},renderTurnstile(){try{const e=this.elements.turnstileSignup;if(!e)return console.warn("Turnstile element not found"),void this.elements.turnstileError.classList.remove("hidden");if(!window.turnstile)return console.warn("Turnstile script not loaded"),this.elements.turnstileError.classList.remove("hidden"),void this.showToast("Verification service unavailable. Please try again later.");if(!this.config.turnstileSiteKey)return console.warn("Turnstile sitekey missing"),this.elements.turnstileError.classList.remove("hidden"),void this.showToast("Verification configuration missing.");turnstileWidgetId&&window.turnstile.reset(turnstileWidgetId);const t=()=>{try{turnstileWidgetId=window.turnstile.render(e,{sitekey:this.config.turnstileSiteKey,theme:"dark",callback:e=>{turnstileToken=e,console.log("Turnstile token received:",e),this.elements.turnstileError.classList.add("hidden")},"error-callback":()=>{turnstileToken=null,console.warn("Turnstile error"),this.elements.turnstileError.classList.remove("hidden"),this.showToast("Verification failed. Please try again.")},"expired-callback":()=>{turnstileToken=null,console.warn("Turnstile token expired"),this.elements.turnstileError.classList.remove("hidden"),this.showToast("Verification expired. Please try again.")}}),console.log("Turnstile widget rendered, ID:",turnstileWidgetId)}catch(e){console.error("Turnstile render failed:",e),this.elements.turnstileError.classList.remove("hidden"),this.showToast("Verification service error.")}},a=5,s=1e3;let n=0;const i=()=>{n<a?(window.turnstile?t():setTimeout(i,s),n++):(console.error("Turnstile failed to load after retries"),this.elements.turnstileError.classList.remove("hidden"),this.showToast("Verification service unavailable."))};i()}catch(e){console.error("Error rendering Turnstile:",e),this.elements.turnstileError.classList.remove("hidden"),this.showToast("Verification setup failed.")}},resetTurnstile(){try{window.turnstile&&turnstileWidgetId?(window.turnstile.reset(turnstileWidgetId),console.log("Turnstile widget reset")):console.warn("No Turnstile widget to reset"),turnstileToken=null,turnstileWidgetId=null,this.elements.turnstileError&&this.elements.turnstileError.classList.add("hidden")}catch(e){console.error("Error resetting Turnstile:",e)}},toggleAuthView(e){try{this.elements.signupView&&this.elements.signupView.classList.toggle("hidden",e),this.elements.loginView&&this.elements.loginView.classList.toggle("hidden",!e),e||this.renderTurnstile()}catch(e){console.error("Error toggling auth view:",e),this.showToast("Error switching auth view.")}},async handleSignup(e){try{e.preventDefault();const t=this.elements.signupForm.querySelector("#signup-username").value.trim(),a=this.elements.signupForm.querySelector("#signup-password").value;if(!t||!a)return void this.showToast("Please fill in all fields");if(!turnstileToken)return this.elements.turnstileError.classList.remove("hidden"),void this.showToast("Please complete the verification challenge.");const s=await this.apiCall("/register",{method:"POST",body:JSON.stringify({username:t,password:a,"cf-turnstile-response":turnstileToken})});this.resetTurnstile(),s&&s.ok?(this.showToast("Account created! Please log in."),this.toggleAuthView(!0)):(s?(this.showToast((await s.json()).message||"Signup failed. Please try again.")):this.showToast("Signup failed. Please try again."))}catch(e){console.error("Error during signup:",e),this.resetTurnstile(),this.showToast("Signup error. Please try again.")}},async handleLogin(e){try{e.preventDefault();const t=this.elements.loginForm.querySelector("#login-username").value.trim(),a=this.elements.loginForm.querySelector("#login-password").value;if(!t||!a)return void this.showToast("Please fill in all fields");const s=await this.apiCall("/login",{method:"POST",body:JSON.stringify({username:t,password:a})});if(s&&s.ok){const e=await s.json();e.success&&(localStorage.setItem("token",e.token),this.state.isLoggedIn=!0,this.state.user={username:e.username,id:JSON.parse(atob(e.token.split(".")[1])).id},this.closeAuthModal(),this.updateUI(),await this.loadTickets(),this.openTicketSystem())}else s?(this.showToast((await s.json()).message||"Login failed.")):this.showToast("Login failed.")}catch(e){console.error("Error during login:",e),this.showToast("Login error. Please try again.")}},logout(){try{localStorage.removeItem("token"),this.state.isLoggedIn=!1,this.state.user=null,this.state.tickets=[],this.state.currentTicketId=null,this.closeTicketSystem(),this.updateUI(),this.showToast("You have been logged out.")}catch(e){console.error("Error during logout:",e),this.showToast("Logout error.")}},showPaymentMethodModal(){try{this.getActiveTicket()||(this.elements.paymentMethodModal&&this.elements.paymentMethodModal.classList.remove("hidden")&&this.elements.paymentMethodModal.classList.add("flex"),setTimeout(()=>{this.elements.paymentMethodModal&&this.elements.paymentMethodModal.classList.add("visible")},10))}catch(e){console.error("Error showing payment modal:",e),this.showToast("Error opening payment options.")}},closePaymentMethodModal(){try{this.elements.paymentMethodModal&&(this.elements.paymentMethodModal.classList.remove("visible"),setTimeout(()=>{this.elements.paymentMethodModal.classList.add("hidden"),this.elements.paymentMethodModal.classList.remove("flex")},300))}catch(e){console.error("Error closing payment modal:",e)}},async handlePaymentMethodConfirm(){try{if(!this.state.selectedPaymentMethod)return void this.showToast("Please select a payment method");this.closePaymentMethodModal();const e=await this.apiCall("/tickets",{method:"POST",body:JSON.stringify({paymentMethod:this.state.selectedPaymentMethod})});e&&e.ok?(this.elements.confirmPaymentBtn.disabled=!0,this.elements.confirmPaymentBtn.classList.add("opacity-50","cursor-not-allowed"),this.elements.paymentMethodOptions.forEach(e=>e.classList.remove("selected")),this.state.tickets.unshift(await e.json()),this.updateUI(),this.openTicket(this.state.tickets[0].id)):(e?(this.showToast((await e.json()).message||"Failed to create ticket.")):this.showToast("Failed to create ticket."))}catch(e){console.error("Error confirming payment method:",e),this.showToast("Error creating purchase ticket.")}},openTicketSystem(){try{this.elements.body&&this.elements.body.classList.add("chat-active"),this.renderSidebar();const e=this.getActiveTicket(),t=[...this.state.tickets].sort((e,t)=>new Date(t.updated_at)-new Date(e.updated_at))[0];e?(this.openTicket(e.id)):t?(this.openTicket(t.id)):(this.elements.ticketViewContent&&this.elements.ticketViewContent.classList.add("hidden"),this.elements.ticketPlaceholder&&this.elements.ticketPlaceholder.classList.remove("hidden"))}catch(e){console.error("Error opening ticket system:",e),this.showToast("Error opening purchase portal.")}},closeTicketSystem(){try{this.elements.body&&this.elements.body.classList.remove("chat-active"),this.updateUI()}catch(e){console.error("Error closing ticket system:",e)}},getActiveTicket(){return this.state.tickets.find(e=>e.status==="awaiting"||e.status==="processing")},openTicket(e){try{const t=this.state.tickets.find(t=>t.id===e);if(!t)return this.elements.ticketViewContent&&this.elements.ticketViewContent.classList.add("hidden"),void(this.elements.ticketPlaceholder&&this.elements.ticketPlaceholder.classList.remove("hidden"));this.elements.ticketPlaceholder&&this.elements.ticketPlaceholder.classList.add("hidden"),this.elements.ticketViewContent&&(this.elements.ticketViewContent.classList.remove("hidden"),this.elements.ticketViewContent.classList.add("flex")),this.state.currentTicketId=e,this.renderSidebar(),this.renderTicketView(t)}catch(e){console.error("Error opening ticket:",e),this.showToast("Error viewing ticket.")}},getPaymentMethodIcon(e){const t={"PayPal":"fab fa-paypal text-blue-600","Crypto":"fab fa-bitcoin text-yellow-500","Credit Card":"fas fa-credit-card text-indigo-400","Bank Transfer":"fas fa-university text-gray-400","Google Pay":"fab fa-google-pay text-blue-500","Apple Pay":"fab fa-apple-pay text-gray-300","CashApp":"fas fa-dollar-sign text-green-500","Gag Pets":"fas fa-paw text-orange-400","Secret Brainrots":"fas fa-brain text-pink-500"};return t[e]||"fas fa-credit-card text-indigo-400"},renderSidebar(){try{const e=this.getActiveTicket(),t=this.elements.newTicketBtn;t&&(t.className="w-full font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center has-ripple",t.removeAttribute("data-status"),e?(t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Purchase in Progress',t.dataset.status="in-progress"):(t.disabled=!1,t.innerHTML='<i class="fas fa-plus mr-2"></i> New Purchase',t.dataset.status="new",t.classList.add("bg-primary/20","text-primary","hover:bg-primary/30"))),this.elements.ticketList&&(this.elements.ticketList.innerHTML=""),this.state.tickets.length===0?(this.elements.ticketList&&(this.elements.ticketList.innerHTML='<div class="empty-state"><i class="fas fa-inbox"></i><h4 class="text-white font-bold text-lg">No Purchases Yet</h4><p class="text-text-muted text-sm">Click "New Purchase" to begin.</p></div>')):[...this.state.tickets].sort((e,t)=>new Date(t.updated_at)-new Date(e.updated_at)).forEach(e=>{const t=document.createElement("div");t.className=`ticket-item has-ripple ${e.id===this.state.currentTicketId?"active":""}`,t.dataset.id=e.id;const a=new Date(e.updated_at).toLocaleDateString(),s=e.messages?.length?e.messages[e.messages.length-1]:{sender:"seller",message:"Ticket created."},n=e.payment_method?`<span class="ticket-payment-badge"><i class="${this.getPaymentMethodIcon(e.payment_method)}"></i> ${e.payment_method}</span>`:"";t.innerHTML=`<div class="flex justify-between items-center mb-1"><h4 class="font-bold text-white truncate">${e.payment_method?e.payment_method+" Purchase":"Ticket #"+String(e.id).padStart(5,"0")}</h4><p class="text-xs text-text-muted flex-shrink-0 ml-2">${a}</p></div>${n}<p class="ticket-item-preview mt-2">${s.sender==="user"?"You: ":""}${s.message}</p>`,t.addEventListener("click",()=>{this.openTicket(e.id),this.elements.ticketAppContainer&&this.elements.ticketAppContainer.classList.add("mobile-chat-view")}),this.elements.ticketList&&this.elements.ticketList.appendChild(t)})}catch(e){console.error("Error rendering sidebar:",e),this.showToast("Error displaying purchase list.")}},renderTicketView(e){try{const t=e.status==="completed";this.elements.chatContainer&&this.elements.chatContainer.classList.toggle("hidden",t),this.elements.completedView&&this.elements.completedView.classList.toggle("hidden",!t),t?(this.elements.licenseKey&&(this.elements.licenseKey.textContent=e.license_key),this.elements.ticketTitle&&(this.elements.ticketTitle.textContent="Order Completed"),this.elements.ticketStatusText&&(this.elements.ticketStatusText.innerHTML='<span class="text-green-400">License Delivered</span>')):(this.elements.ticketTitle&&(this.elements.ticketTitle.textContent=e.payment_method?`${e.payment_method} Purchase`:`Ticket #${String(e.id).padStart(5,"0")}`),this.elements.ticketStatusText&&this.elements.ticketStatusText.innerHTML=`<span class="${{awaiting:"text-yellow-400",processing:"text-blue-400"}[e.status]||"text-green-400"}">${{awaiting:"Awaiting Payment",processing:"Processing Payment"}[e.status]||"Active"}</span>`),this.populateMessages(e.messages||[])}catch(e){console.error("Error rendering ticket view:",e),this.showToast("Error displaying ticket details.")}},populateMessages(e){try{this.elements.chatMessages&&(this.elements.chatMessages.innerHTML=""),e.forEach(e=>this.appendMessage(e)),this.elements.chatMessages&&(this.elements.chatMessages.scrollTop=this.elements.chatMessages.scrollHeight)}catch(e){console.error("Error populating messages:",e)}},appendMessage(e){try{const t=document.createElement("div"),a=new Date(e.created_at).toLocaleTimeString([],[{hour:"2-digit",minute:"2-digit"}]);t.className=`flex flex-col ${e.sender==="user"?"items-end":"items-start"}`,t.innerHTML=`<div class="chat-bubble ${e.sender==="user"?"chat-bubble-user":"chat-bubble-seller"}">${e.message}</div><div class="text-xs text-text-muted mt-1 px-2">${a}</div>`,this.elements.chatMessages&&this.elements.chatMessages.appendChild(t),this.elements.chatMessages&&(this.elements.chatMessages.scrollTop=this.elements.chatMessages.scrollHeight)}catch(e){console.error("Error appending message:",e)}},async handleChatMessage(e){try{e.preventDefault();const t=this.elements.chatInput.value.trim(),a=this.state.tickets.find(e=>e.id===this.state.currentTicketId);if(!t||!a||a.status==="completed")return;const s={sender:"user",message:t,created_at:(new Date).toISOString()};a.messages.push(s),this.appendMessage(s),this.renderSidebar(),this.elements.chatInput.value="",this.elements.chatForm.querySelector("button").disabled=!0;const n=await this.apiCall(`/tickets/${a.id}/messages`,{method:"POST",body:JSON.stringify({message:t})});n&&n.ok?(this.state.tickets[this.state.tickets.findIndex(e=>e.id===a.id)]=await n.json(),this.renderSidebar(),this.renderTicketView(a)):(this.showToast("Failed to send message."),a.messages.pop(),this.renderTicketView(a)),this.elements.chatForm.querySelector("button").disabled=!1}catch(e){console.error("Error handling chat message:",e),this.showToast("Error sending message.")}},copyLicenseKey(){try{const e=this.elements.licenseKey.textContent;navigator.clipboard.writeText(e).then(()=>{this.elements.copyKeyBtn.innerHTML='<i class="fas fa-check mr-2"></i> Copied!',setTimeout(()=>{this.elements.copyKeyBtn.innerHTML='<i class="fas fa-copy mr-2"></i> Copy to Clipboard'},2e3)}).catch(e=>{console.error("Error copying license key:",e),this.showToast("Failed to copy license key.")})}catch(e){console.error("Error in copyLicenseKey:",e),this.showToast("Error copying license key.")}}};document.addEventListener("DOMContentLoaded",()=>{try{App.init()}catch(e){console.error("Error starting application:",e),App.showToast&&App.showToast("Application failed to start. Please refresh.")}})
  </script>
</body>
</html>
